#! /bin/bash

NTPDATE_CONF_FILE=/etc/default/ntpdate
NTP_SERVERS="64.2.3.4"

NTP_SERVICE=/etc/init.d/ntp-server
NTPDATE_SERVICE=/etc/init.d/ntpdate

if ! grep -iq "# Generated by Untangle" $NTPDATE_CONF_FILE ; then
  cp $NTPDATE_CONF_FILE $NTPDATE_CONF_FILE.`date -Iseconds`.bak
  cat >| $NTPDATE_CONF_FILE <<EOF 
# Generated by Untangle
NTPSERVERS="$NTP_SERVERS"
NTPOPTIONS="-u"
EOF
  $NTP_SERVICE stop
  $NTPDATE_SERVICE restart
  $NTP_SERVICE start
fi

exit 0
