<?php

/*
 *
 *
 * --------------------------------------------------------------------
 * Copyright (c) 2001 - 2008 Openfiler Project.
 * --------------------------------------------------------------------
 *
 * Openfiler is an Open Source SAN/NAS Appliance Software Distribution
 *
 * This file is part of Openfiler.
 *
 * Openfiler is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * Openfiler is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Openfiler.  If not, see <http://www.gnu.org/licenses/>.
 *
 * This file was modified by Untangle, Inc. in 2009.
 * These changes are Copyright (c) 2009 Untangle, Inc.
 *
 * --------------------------------------------------------------------
 *
 *
 */

    require("pre.inc");
    include("authenticated.inc");

	$volumes_id = array();
	$volumes_name = array();
	$volumes_mountpoint = array();
	$volumes_vg = array();
	$volumes_fstype = array();

	function volumes_startelement($parser, $name, $attrs)
	{
		global $volumes_id, $volumes_name, $volumes_mountpoint, $volumes_vg, $volumes_fstype;

		if ($name == "VOLUME")
		{
			array_push($volumes_id, $attrs["ID"]);
			array_push($volumes_name, $attrs["NAME"]);
			array_push($volumes_mountpoint, $attrs["MOUNTPOINT"]);
			array_push($volumes_vg, $attrs["VG"]);
			array_push($volumes_fstype, $attrs["FSTYPE"]);
		}
	}

	function volumes_endelement($parser, $name)
	{
	}

	$volumes_parser = xml_parser_create();
	xml_set_element_handler($volumes_parser, "volumes_startelement", "volumes_endelement");
	$volumes_fp = fopen("/opt/nas/etc/volumes.xml", "r");

	while ($volumes_data = fread($volumes_fp, 4096))
		xml_parse($volumes_parser, $volumes_data, feof($volumes_fp));

	fclose($volumes_fp);
	xml_parser_free($volumes_parser);

	$snapshots_id = array();
	$snapshots_lvname = array();
	$snapshots_vgname = array();
	$snapshots_shared = array();
	$snapshots_rotateid = array();

	$schedule_size = array();
	$schedule_share = array();
	$schedule_timecounter = array();
	$schedule_timemax = array();
	$schedule_rotatecounter = array();
	$schedule_rotatemax = array();
	$schedule_lvname = array();
	$schedule_vgname = array();

	function snapshots_startelement($parser, $name, $attrs)
	{
		global $snapshots_id, $snapshots_lvname, $snapshots_vgname, $snapshots_shared, $snapshots_rotateid;
		global $schedule_size, $schedule_share;
		global $schedule_timecounter, $schedule_timemax;
		global $schedule_rotatecounter, $schedule_rotatemax;
		global $schedule_lvname, $schedule_vgname;

		if ($name == "SNAPSHOT")
		{
			array_push($snapshots_id, $attrs["ID"]);
			array_push($snapshots_lvname, $attrs["LVNAME"]);
			array_push($snapshots_vgname, $attrs["VGNAME"]);
			array_push($snapshots_shared, $attrs["SHARED"]);
			array_push($snapshots_rotateid, $attrs["ROTATEID"]);
		}
		else if ($name == "SCHEDULE")
		{
			array_push($schedule_size, $attrs["SIZE"]);
			array_push($schedule_share, $attrs["SHARE"]);
			array_push($schedule_timecounter, $attrs["TIMECOUNTER"]);
			array_push($schedule_timemax, $attrs["TIMEMAX"]);
			array_push($schedule_rotatecounter, $attrs["ROTATECOUNTER"]);
			array_push($schedule_rotatemax, $attrs["ROTATEMAX"]);
			array_push($schedule_lvname, $attrs["LVNAME"]);
			array_push($schedule_vgname, $attrs["VGNAME"]);
		}
	}

	function snapshots_endelement($parser, $name)
	{
	}

	$snapshots_parser = xml_parser_create();
	xml_set_element_handler($snapshots_parser, "snapshots_startelement", "snapshots_endelement");
	$snapshots_fp = fopen("/opt/nas/etc/snapshots.xml", "r");

	while ($snapshots_data = fread($snapshots_fp, 4096))
		xml_parse($snapshots_parser, $snapshots_data, feof($snapshots_fp));

	fclose($snapshots_fp);
	xml_parser_free($snapshots_parser);

	global $cluster_enabled, $cluster_nodename, $cluster_resource;

	$cluster_enabled = false;
	$cluster_nodename = "";
	$cluster_resource = array();

	function cluster_startelement($parser, $name, $attrs)
	{
		global $cluster_enabled, $cluster_nodename, $cluster_resource;

		if ($name == "CLUSTERING")
		{
			if ($attrs["STATE"] == "on")
				$cluster_enabled = true;
			else
				$cluster_enabled = false;
		}
		else if ($name == "NODENAME")
			$cluster_nodename = $attrs["VALUE"];
		else if ($name == "RESOURCE")
			array_push($cluster_resource, $attrs["VALUE"]);
	}

	function cluster_endelement($parser, $name)
	{
	}

	$cluster_parser = xml_parser_create();
	xml_set_element_handler($cluster_parser, "cluster_startelement", "cluster_endelement");
	$cluster_fp = fopen("/opt/nas/etc/cluster.xml", "r");

	while ($cluster_data = fread($cluster_fp, 4096))
		xml_parse($cluster_parser, $cluster_data, feof($cluster_fp));

	fclose($cluster_fp);
	xml_parser_free($cluster_parser);
  $_services = null;
  if(isset($services)){
    $_services = $services;
  }else{
    $_services = array($service);      
  }
	if ($action == "disable")
	{
     for($i=0;$i<count($_services);$i++){
            $service = $_services[$i];	
            if ($service == "smb")
            {
                    exec("export LANG=C; /usr/bin/sudo /etc/init.d/samba stop");
                    if (!$cluster_enabled)
                            exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d -f samba remove");
            }
            else if ($service == "nfsv3")
            {
                    exec("export LANG=C; /usr/bin/sudo /etc/init.d/nfs-kernel-server stop");
                    if (!$cluster_enabled)
                            exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d -f nfs-kernel-server remove");
            }
            else if ($service == "http")
            {
	      // print("XXX -- Can't disable http via daemon");
            }

            else if ($service == "ftp")
            {
                    exec("export LANG=C; /usr/bin/sudo /etc/init.d/proftpd stop");
                    if (!$cluster_enabled)
                            exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d -f proftpd remove");
            }

            else if ($service == "iscsi")
            {
                    exec("export LANG=C; /usr/bin/sudo /etc/init.d/iscsitarget stop");
                    if (!$cluster_enabled)
                            exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d -f iscsitarget remove");
            }

            else if ($service == "rsync")
            {
                    exec("export LANG=C; /usr/bin/sudo /etc/init.d/rsync stop");
                    if(!$cluster_enabled)
                            exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d -f rsync remove");
            }

            else if ($service == "ldap")
            {
	      // print("XXX -- Can't disable ldap via daemon");
            }
            else if ($service == "ups")
            {
                    exec("export LANG=C; /usr/bin/sudo /etc/init.d/upsd stop");
                    if(!$cluster_enabled)
                            exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d -f upsd remove");
            }

            else if ($service == "acpid")
            {
                exec("export LANG=C; /usr/bin/sudo /etc/init.d/acpid stop");
                if(!$cluster_enabled)
                    exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d -f acpid remove");
            }

            else if ($service == "open-iscsi")
            {
                exec("export LANG=C; /usr/bin/sudo /etc/init.d/open-iscsi stop");
                if(!$cluster_enabled)
                    exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d -f open-iscsi remove");
            }
      }




            if ($cluster_enabled)
            {
                $service_winbind = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status winbind"), "running") ? 1 : 0);
                $service_smb = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status samba"), "running") ? 1 : 0);
                $service_nfsv3 = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status nfs-kernel-server"), "running") ? 1 : 0);
                $service_http = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status httpd"), "running") ? 1 : 0);
                $service_ftp = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status proftpd"), "running") ? 1 : 0);
                $service_iscsi = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status iscsitarget"), "running") ? 1 : 0);
                $service_ups = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status upsd"), "running") ? 1 : 0);
                $service_rsync = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status rsync"), "running") ? 1 : 0);
                $service_ldap = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status ldap"), "running") ? 1 : 0);
                $service_acpid = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status acpid"), "running") ? 1 : 0);
                $service_open_iscsi = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status open-iscsi"), "running") ? 1 : 0);

                $clusterp = popen("export LANG=C; /usr/bin/sudo /usr/bin/tee /etc/ha.d/haresources >/dev/null", "w");

                $cluster_resource_str = "";

            if ($service_open_iscsi > 0)
                $cluster_resource_str .= " open-iscsi ";

			for ($i = 0; $i < count($cluster_resource); $i++)
				$cluster_resource_str .= " " . $cluster_resource[$i];

			for ($i = 0; $i < count($volumes_id); $i++)
			{
				$fstype = $volumes_fstype[$i];

				if ($fstype != "iscsi")
				{
					$fs = 0;
					$fsfound = false;

					for ($fsi = 0; $fsi < count($fs_info); $fsi++)
					{
						if ($fs_info[$fsi]["type"] == $fstype)
						{
							$fs = $fsi;
							$fsfound = true;
							break;
						}
					}

					if ($fsfound == false)
						$fs = 0;

					$cluster_resource_str .= " Filesystem::/dev/" . $volumes_vg[$i] . "/" . $volumes_id[$i] . "::" . "/mnt/" . $volumes_vg[$i] . "/" . $volumes_id[$i] . "::" . $fs_info[$fs]["type"] . "::" . $fs_info[$fs]["mount_options"];
				}
			}

			for ($i = 0; $i < count($snapshots_id); $i++)
			{
				$fstype = "";

				for ($fsj = 0; $fsj < count($volumes_id); $fsj++)
				{
					if (($snapshots_vgname[$i] == $volumes_vg[$fsj]) && ($snapshots_lvname[$i] == $volumes_id[$fsj]))
					{
						$fstype = $volumes_fstype[$fsj];
						break;
					}
				}

				if ($fstype != "iscsi")
				{
					$fs = 0;
					$fsfound = false;

					for ($fsi = 0; $fsi < count($fs_info); $fsi++)
					{
						if ($fs_info[$fsi]["type"] == $fstype)
						{
							$fs = $fsi;
							$fsfound = true;
							break;
						}
					}

					if ($fsfound == false)
						$fs = 0;

					$cluster_resource_str .= " Filesystem::/dev/" . $snapshots_vgname[$i] . "/of.snapshot." . $snapshots_lvname[$i] . "." . $snapshots_id[$i] . "::" . "/mnt/snapshots/" . $snapshots_vgname[$i] . "/" . $snapshots_lvname[$i] . "/" . $snapshots_id[$i] . "::" . $fs_info[$fs]["type"] . "::" . $fs_info[$fs]["snapshot_mount_options"];
				}
			}

			if ($service_winbind > 0)
				$cluster_resource_str .= " winbind";
			if ($service_http > 0)
				$cluster_resource_str .= " httpd";
			if ($service_ftp > 0)
				$cluster_resource_str .= " proftpd";
			if ($service_nfsv3 > 0)
				$cluster_resource_str .= " nfs-kernel-server";
			if ($service_smb > 0)
				$cluster_resource_str .= " samba";
			if ($service_iscsi > 0)
			    $cluster_resource_str .= " iscsitarget";
			if ($service_ups > 0)
			    $cluster_resource_str .= " ups";
			if ($service_rsync > 0)
			    $cluster_resource_str .= " rsync";
			if ($service_ldap > 0)
				$cluster_resource_str .= " ldap";
                        if ($service_acpid > 0)
                            $cluster_resource_str .= " acpid";



			$cluster_resource_str .= " nas";

			fputs($clusterp, $cluster_nodename . $cluster_resource_str . "\n");
			pclose($clusterp);

			apply_configuration(array("services" => "keep", "chmod" => "no", "chmod_path" => ""));
		}

		header("Location: ./services.html".getAttachment());
		exit;
	}
	else if ($action == "enable")
	{
     for($i=0;$i<count($_services);$i++){
      $service = $_services[$i];	
    	if ($service == "smb")
    	{
    		exec("export LANG=C; /usr/bin/sudo /etc/init.d/samba start");
    		if (!$cluster_enabled)
    			exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d smb defaults");
    	}
    	else if ($service == "nfsv3")
    	{
    		exec("export LANG=C; /usr/bin/sudo /etc/init.d/nfs-kernel-server start");
    		if (!$cluster_enabled)
    			exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d nfs defaults");
    	}
    	else if ($service == "http")
    	{
	  // print("XXX -- Can't enable http via daemon");
    	}
    
    	else if ($service == "ftp")
    	{
    		exec("export LANG=C; /usr/bin/sudo /etc/init.d/proftpd start");
    		if (!$cluster_enabled)
    			exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d proftpd defaults");
    	}
    
    	else if ($service == "iscsi")
    	{
    		exec("export LANG=C; /usr/bin/sudo /etc/init.d/iscsitarget start");
    		if (!$cluster_enabled)
    			exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d iscsitarget defaults");
    	}
    
    	else if ($service == "rsync")
    	{
    		exec("export LANG=C; /usr/bin/sudo /etc/init.d/rsync start");
    		if (!$cluster_enabled)
    			exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d rsync defaults");
    	}
    
    	else if ($service == "ldap")
    	{
	  // print("XXX -- Can't enable ldap via daemon");
    	}
    
          else if ($service == "acpid")
          {
              exec("export LANG=C; /usr/bin/sudo /etc/init.d/acpid start");
              if (!$cluster_enabled)
                  exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d acpid defaults");
          }
    
          else if ($service == "open-iscsi")
          {
              exec("export LANG=C; /usr/bin/sudo /etc/init.d/open-iscsi start");
              if (!$cluster_enabled)
                  exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d open-iscsi defaults");
          }
    
    	else if ($service == "ups")
    	{
                      exec("export LANG=C; /usr/bin/sudo " . "/bin/cp /opt/nas/etc/plugins/ups/configs/generated_ups_conf.conf /etc/ups/ups.conf");
                      exec("export LANG=C; /usr/bin/sudo " . "/bin/cp /opt/nas/etc/plugins/ups/configs/generated_upsd_conf.conf /etc/ups/upsd.conf");
                      exec("export LANG=C; /usr/bin/sudo " . "/bin/cp /opt/nas/etc/plugins/ups/configs/generated_upsd_users_conf.conf /etc/ups/upsd.users");
                      exec("export LANG=C; /usr/bin/sudo " . "/bin/cp /opt/nas/etc/plugins/ups/configs/generated_upsmon_conf.conf /etc/ups/upsmon.conf");
                      exec("export LANG=C; /usr/bin/sudo " . "/bin/cp /opt/nas/etc/plugins/ups/configs/generated_sysconfig_ups.conf /etc/sysconfig/ups");
    
                      exec("export LANG=C; /usr/bin/sudo /etc/init.d/upsd start");
                      if(!$cluster_enabled)
                              exec("export LANG=C; /usr/bin/sudo /usr/sbin/update-rc.d upsd defaults");
    
    	}
    }
		if ($cluster_enabled)
		{
                    $service_winbind = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status winbind"), "running") ? 1 : 0);
                    $service_smb = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status samba"), "running") ? 1 : 0);
                    $service_nfsv3 = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status nfs-kernel-server"), "running") ? 1 : 0);
                    $service_http = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status httpd"), "running") ? 1 : 0);
                    $service_ftp = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status proftpd"), "running") ? 1 : 0);
                    $service_iscsi = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status iscsitarget"), "running") ? 1 : 0);
                    $service_rsync = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status rsync"), "running") ? 1 : 0);
                    $service_ups = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status upsd"), "running") ? 1 : 0);
                    $service_ldap = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status ldap"), "running") ? 1 : 0);
                    $service_acpid = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status acpid"), "running") ? 1 : 0);
                    $open_iscsi = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status open-iscsi"), "running") ? 1 : 0);

                    $clusterp = popen("export LANG=C; /usr/bin/sudo /usr/bin/tee /etc/ha.d/haresources >/dev/null", "w");

                    $cluster_resource_str = "";

            if ($service_open_iscsi > 0)
                $cluster_resource_str .= " open-iscsi ";

			for ($i = 0; $i < count($cluster_resource); $i++)
				$cluster_resource_str .= " " . $cluster_resource[$i];

			for ($i = 0; $i < count($volumes_id); $i++)
			{
				$fstype = $volumes_fstype[$i];

				if ($fstype != "iscsi")
				{
					$fs = 0;
					$fsfound = false;

					for ($fsi = 0; $fsi < count($fs_info); $fsi++)
					{
						if ($fs_info[$fsi]["type"] == $fstype)
						{
							$fs = $fsi;
							$fsfound = true;
							break;
						}
					}

					if ($fsfound == false)
						$fs = 0;

					$cluster_resource_str .= " Filesystem::/dev/" . $volumes_vg[$i] . "/" . $volumes_id[$i] . "::" . "/mnt/" . $volumes_vg[$i] . "/" . $volumes_id[$i] . "::" . $fs_info[$fs]["type"] . "::" . $fs_info[$fs]["mount_options"];
				}
			}

			for ($i = 0; $i < count($snapshots_id); $i++)
			{
				$fstype = "";

				for ($fsj = 0; $fsj < count($volumes_id); $fsj++)
				{
					if (($snapshots_vgname[$i] == $volumes_vg[$fsj]) && ($snapshots_lvname[$i] == $volumes_id[$fsj]))
					{
						$fstype = $volumes_fstype[$fsj];
						break;
					}
				}

				if ($fstype != "iscsi")
				{
					$fs = 0;
					$fsfound = false;

					for ($fsi = 0; $fsi < count($fs_info); $fsi++)
					{
						if ($fs_info[$fsi]["type"] == $fstype)
						{
							$fs = $fsi;
							$fsfound = true;
							break;
						}
					}

					if ($fsfound == false)
						$fs = 0;

					$cluster_resource_str .= " Filesystem::/dev/" . $snapshots_vgname[$i] . "/of.snapshot." . $snapshots_lvname[$i] . "." . $snapshots_id[$i] . "::" . "/mnt/snapshots/" . $snapshots_vgname[$i] . "/" . $snapshots_lvname[$i] . "/" . $snapshots_id[$i] . "::" . $fs_info[$fs]["type"] . "::" . $fs_info[$fs]["snapshot_mount_options"];
				}
			}

			if ($service_winbind > 0)
				$cluster_resource_str .= " winbind";
			if ($service_http > 0)
				$cluster_resource_str .= " httpd";
			if ($service_ftp > 0)
				$cluster_resource_str .= " proftpd";
			if ($service_nfsv3 > 0)
				$cluster_resource_str .= " nfs-kernel-server";
			if ($service_smb > 0)
				$cluster_resource_str .= " samba";
			if ($service_iscsi > 0)
				$cluster_resource_str .= " iscsitarget";
			if ($service_rsync > 0)
				$cluster_resource_str .= " rsync";
			if ($service_ups > 0)
				$cluster_resource_str .= " ups";
			if ($service_ldap > 0)
				$cluster_resource_str .= " ldap";
            if ($service_acpid > 0)
                $cluster_resource_str .= " acpid";

			$cluster_resource_str .= " nas";

			fputs($clusterp, $cluster_nodename . $cluster_resource_str . "\n");
			pclose($clusterp);

			apply_configuration(array("services" => "keep", "chmod" => "no", "chmod_path" => ""));
		}

		header("Location: ./services.html".getAttachment());
		exit;
	}

	$smb = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status samba"), "running") ? 1 : 0);
	$nfsv3 = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status nfs-kernel-server"), "running") ? 1 : 0);
	$ups = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status upsd"), "running") ? 1 : 0);
	$http = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status httpd"), "running") ? 1 : 0);
	$ftp = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status proftpd"), "running") ? 1 : 0);
	$ldap = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status ldap"), "running") ? 1 : 0);
	$iscsi = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status iscsitarget"), "running") ? 1 : 0);
	$rsync = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status rsync"), "running") ? 1 : 0);
	$acpid = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status acpid"), "running") ? 1 : 0);
  $open_iscsi = (strstr(exec("export LANG=C; /opt/nas/sbin/service-status open-iscsi"), "running") ? 1 : 0);
  $services_array = array(array("service"=>"smb","status"=>$smb,"display"=>"Samba /CIFS (Windows File Sharing)"),array("service"=>"nfsv3","status"=>$nfsv3,"display"=>"NFSv3 (Network File System Version 3)"),array("service"=>"http","status"=>$http,"display"=>"Http / Web DAV (Modify Files Over the Web)"),array("service"=>"ftp","status"=>$ftp,"display"=>"FTP (File Transfer Protocol)"));
  if($_REQUEST['responseType']=='json'){
      if($_REQUEST['callback']){
          echo wrapAround($_REQUEST['callback'],'{rows:'.json_encode($services_array).'}');
      }else{
          echo json_encode($services_array);
      }
      return;
  }
	generic_header(array("title" => _("Services Section")));
	single_begin(array());

?>

<p>&nbsp;</p>

<?php
	nested_tab_begin("C_SERVICES");
    print("<h3 align=\"center\">Manage Services</h3>\n");
	print("<div align=\"center\">\n");
	print("<table cellpadding=\"10\" cellspacing=\"2\" border=\"0\">\n");

	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_heading"] . "\"><strong>Service Name</strong></td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_heading"] . "\"><strong>Status</strong></td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_heading"] . "\"><strong>Modification</strong></td>\n");
	print("</tr>\n");

	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\">SMB / CIFS server</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\">" . (($smb != 0) ? "Enabled" : "Disabled") . "</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\"><a href=\"services.html?service=smb&amp;action=" . (($smb != 0) ? "disable" : "enable") . "\">" . (($smb != 0) ? "Disable" : "Enable") . "</a></td>\n");
	print("</tr>\n");


	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\">NFSv3 server</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\">" . (($nfsv3 != 0) ? "Enabled" : "Disabled") . "</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\"><a href=\"services.html?service=nfsv3&amp;action=" . (($nfsv3 != 0) ? "disable" : "enable") . "\">" . (($nfsv3 != 0) ? "Disable" : "Enable") . "</a></td>\n");
	print("</tr>\n");

	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\">HTTP / WebDAV server</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\">" . (($http != 0) ? "Enabled" : "Disabled") . "</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\"><a href=\"services.html?service=http&amp;action=" . (($http != 0) ? "disable" : "enable") . "\">" . (($http != 0) ? "Disable" : "Enable") . "</a></td>\n");
	print("</tr>\n");

	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\">FTP server</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\">" . (($ftp != 0) ? "Enabled" : "Disabled") . "</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\"><a href=\"services.html?service=ftp&amp;action=" . (($ftp != 0) ? "disable" : "enable") . "\">" . (($ftp != 0) ? "Disable" : "Enable") . "</a></td>\n");
	print("</tr>\n");

	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\">Rsync server</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\">" . (($rsync != 0) ? "Enabled" : "Disabled") . "</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\"><a href=\"services.html?service=rsync&amp;action=" . (($rsync != 0) ? "disable" : "enable") . "\">" . (($rsync != 0) ? "Disable" : "Enable") . "</a></td>\n");
	print("</tr>\n");

	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\">iSCSI target server</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\">" . (($iscsi != 0) ? "Enabled" : "Disabled") . "</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\"><a href=\"services.html?service=iscsi&amp;action=" . (($iscsi != 0) ? "disable" : "enable") . "\">" . (($iscsi != 0) ? "Disable" : "Enable") . "</a></td>\n");
	print("</tr>\n");

	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\">UPS server</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\">" . (($ups != 0) ? "Enabled" : "Disabled") . "</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\"><a href=\"services.html?service=ups&amp;action=" . (($ups != 0) ? "disable" : "enable") . "\">" . (($ups != 0) ? "Disable" : "Enable") . "</a></td>\n");
	print("</tr>\n");

    /*
	print("<tr>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\">LDAP server</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\">" . (($ldap != 0) ? "Enabled" : "Disabled") . "</td>\n");
	print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\"><a href=\"services.html?service=ldap&amp;action=" . (($ldap != 0) ? "disable" : "enable") . "\">" . (($ldap != 0) ? "Disable" : "Enable") . "</a></td>\n");
	print("</tr>\n");
    */

        print("<tr>\n");
        print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\">ACPI daemon</td>\n");
        print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\">" . (($acpid != 0) ? "Enabled" : "Disabled") . "</td>\n");
        print("\t<td bgcolor=\"" . $GLOBALS["color_table_row1"] . "\" align=\"center\"><a href=\"services.html?service=acpid&amp;action=" . (($acpid != 0) ? "disable" : "enable") . "\">" . (($acpid != 0) ? "Disable" : "Enable") . "</a></td>\n");
        print("</tr>\n");

        print("<tr>\n");
        print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\">iSCSI initiator</td>\n");
        print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\">" . (($open_iscsi != 0) ? "Enabled" : "Disabled") . "</td>\n");
        print("\t<td bgcolor=\"" . $GLOBALS["color_table_row2"] . "\" align=\"center\"><a href=\"services.html?service=open-iscsi&amp;action=" . (($open_iscsi != 0) ? "disable" : "enable") . "\">" . (($open_iscsi != 0) ? "Disable" : "Enable") . "</a></td>\n");
        print("</tr>\n");


	print("</table>\n");
	print("</div>\n");

	nested_tab_end();

	single_end(array());
	generic_footer(array());
?>
