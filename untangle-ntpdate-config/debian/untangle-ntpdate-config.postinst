#! /bin/bash

NTPDATE_CONF_FILE=/etc/default/ntpdate
NTPDATE_SERVER=64.2.3.4

NTP_SERVICE=/etc/init.d/ntp-server
NTPDATE_SERVICE=/etc/init.d/ntpdate

if ! grep -q $NTPDATE_SERVER $NTPDATE_CONF_FILE ; then
  cp $NTPDATE_CONF_FILE $NTPDATE_CONF_FILE.`date -Iseconds`.bak
  cat >| $NTPDATE_CONF_FILE <<EOF 
# Generated by Untangle
NTPSERVERS="$NTPDATE_SERVER"
NTPOPTIONS="-u"
EOF
  $NTP_SERVICE stop
  $NTPDATE_SERVICE restart
  $NTP_SERVICE start
fi

exit 0
