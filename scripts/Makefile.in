DISTRIBUTION ?= `cat ../../version/resources/RELEASE_CODENAME`

checkroot:
	@if [ "$$UID" = "0" ]; then \
	  echo "You can't be root to build packages"; \
	  exit 1; \
	fi

clean:
	fakeroot debian/rules clean

pkg:
	# FIXME: sign packages when we move to apt 0.6
	/usr/bin/debuild --no-tgz-check -us -uc

version:
	dch -i -D $(DISTRIBUTION) "auto build"

release: checkroot clean version pkg
	svn commit -m"released" debian/changelog
	dput -c ../scripts/dput.cf mephisto ../`head -n 1 debian/changelog | perl -npe 's/ \((.*)\).*/*$$1/'`*.changes
